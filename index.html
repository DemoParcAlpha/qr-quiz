<!DOCTYPE html>
<html lang="fr">

<head>

    <!-- Live render /!\ DEBUG ONLY /!\ -->
    <script type="text/javascript" src="https://livejs.com/live.js"></script>

    <title>Template</title>
    <link rel="stylesheet" href="./style/css/base.css" />
    <link rel="stylesheet" href="./style/css/style.css" />
    <!-- Tab icon -->
    <link href="./ressources/icons/tab-icon-light.svg" rel="icon" media="(prefers-color-scheme: light)" />
    <link href="./ressources/icons/tab-icon-dark.svg" rel="icon" media="(prefers-color-scheme: dark)" />
    <!-- Tab color -->
    <meta name="theme-color" content="#333">
    <meta name="msapplication-navbutton-color" content="#333">
    <meta name="apple-mobile-web-app-status-bar-style" content="#333">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Font awesome import -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300..700&family=Jost:ital,wght@0,100..900;1,100..900&family=Manrope:wght@200..800&family=Outfit:wght@100..900&display=swap"
        rel="stylesheet">

<body>
    <main>
        <div id="question">
            <div id="title-section">
                <div id="subtitle"></div>
                <div id="title">
                </div>
            </div>
            <div id="image-wrapper">
                <img id="image" alt="">
            </div>
            <div id="answers">
            </div>
        </div>
        <div id="qr-error">
            <div class="error-title">QR inconnu ou non détecté</div>
            <div class="error-content">Ce QR code n'est pas reconnu. Essayer de scanner le code à nouveau.</div>
        </div>
    </main>
    <script>
        function initAnswersSys() {
            const answers = document.querySelectorAll('.answer');
            console.log(answers);

            answers.forEach(answer => {
                if (answer.classList.contains('right-ans')) {
                    answer.addEventListener('pointerdown', () => {
                        answers.forEach(el => el.classList.add('revealed'));
                        answer.classList.add('clicked');
                        answer.style.pointerEvents = 'none';
                        confetti();
                    });
                } else {
                    answer.addEventListener('pointerdown', () => {
                        answers.forEach(el => el.classList.add('revealed'));
                        answer.classList.add('clicked');
                        answer.style.pointerEvents = 'none';
                    });
                }
            });
        }

        // Récupère les paramètres de l'URL
        const params = new URLSearchParams(window.location.search);
        const id = params.get('id');

        fetch('./contenus.json')
            .then(response => response.json())
            .then(contenus => {
                // Si ID trouvé dans le tableau, on affiche son contenu
                if (contenus[id]) {
                    const entry = contenus[id];

                    document.getElementById('title').textContent = entry.title;
                    document.getElementById('subtitle').textContent = entry.sub;
                    const question = document.getElementById('question');
                    const img_wrapper = document.getElementById('image-wrapper');
                    const img = document.getElementById('image');
                    const title_section = document.getElementById('title-section');
                    if (entry.image && entry.image.trim() !== "") {
                        img.src = entry.image;
                        img_wrapper.style.display = "flex";
                    } else {
                        img_wrapper.style.display = "none";
                        question.classList.add("no-img");
                    }
                    const list = document.getElementById('answers');
                    if (entry.answers && entry.answers.length !== 0) {
                        entry.answers.forEach((answer, idx) => {
                            const li = document.createElement('div');
                            li.textContent = answer;
                            li.classList.add("answer")
                            list.appendChild(li);
                            if (idx == entry.answer) {
                                li.classList.add('right-ans');
                            } else {
                                li.classList.add('wrong-ans');
                            }
                        });
                    } else {
                        title_section.style.flexDirection = "column-reverse";
                        list.style.display = "none";
                    }

                } else {
                    document.getElementById('question').style.display = "none";
                    document.getElementById('qr-error').style.display = "flex";
                }
            })
            // .catch(err => console.error('Erreur de chargement JSON:', err))
            .then(initAnswersSys);
    </script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
</body>

</html>